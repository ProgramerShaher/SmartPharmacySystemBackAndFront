<div class="card">
    <h5>New Sale Invoice</h5>
    <form [formGroup]="saleForm" (ngSubmit)="saveSale()">
        <div class="p-fluid grid formgrid">
            <div class="field col-12 md:col-6">
                <label for="customerName">Customer Name</label>
                <input pInputText id="customerName" formControlName="customerName" />
            </div>
            <div class="field col-12 md:col-6">
                <label for="paymentMethod">Payment Method</label>
                <p-dropdown [options]="paymentMethods" formControlName="paymentMethod"
                    placeholder="Select Method"></p-dropdown>
            </div>

            <div class="col-12">
                <h5>Items</h5>
                <p-table [value]="items.controls" dataKey="value.id" editMode="row">
                    <ng-template pTemplate="header">
                        <tr>
                            <th>Medicine</th>
                            <th>Quantity</th>
                            <th>Unit Price</th>
                            <th>Total</th>
                            <th>Action</th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-item let-i="rowIndex" formArrayName="items">
                        <tr [formGroupName]="i">
                            <td>
                                <input pInputText formControlName="medicineId" placeholder="Medicine ID" />
                            </td>
                            <td>
                                <input pInputText type="number" formControlName="quantity"
                                    (change)="calculateTotal(i)" />
                            </td>
                            <td>
                                <input pInputText type="number" formControlName="unitPrice"
                                    (change)="calculateTotal(i)" />
                            </td>
                            <td>
                                {{ item.get('totalPrice')?.value | currency }}
                            </td>
                            <td>
                                <p-button icon="pi pi-trash" severity="danger" [rounded]="true" [outlined]="true"
                                    (onClick)="removeItem(i)"></p-button>
                            </td>
                        </tr>
                    </ng-template>
                </p-table>
                <button pButton type="button" label="Add Item" icon="pi pi-plus" class="mt-3"
                    (click)="addItem()"></button>
            </div>

            <div class="field col-12 mt-3">
                <div class="text-xl font-bold text-right">
                    Total Amount: {{ totalAmount | currency }}
                </div>
            </div>
        </div>

        <div class="flex justify-content-end gap-2 mt-4">
            <p-button label="Cancel" icon="pi pi-times" styleClass="p-button-text" (onClick)="cancel()"></p-button>
            <p-button label="Process Sale" icon="pi pi-check" type="submit" [disabled]="saleForm.invalid"></p-button>
        </div>
    </form>
</div>