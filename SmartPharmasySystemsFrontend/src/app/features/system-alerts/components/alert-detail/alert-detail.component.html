<div class="alert-detail-container p-4">
  <p-confirmDialog [style]="{width: '450px'}"></p-confirmDialog>
  <p-toast></p-toast>

  <div class="max-w-4xl mx-auto">
    <!-- Header Card -->
    <div
      class="card bg-primary-700 text-white border-none shadow-4 mb-4 p-5 border-round-xl flex flex-column md:flex-row align-items-center justify-content-between gap-3">
      <div class="flex align-items-center gap-4">
        <button pButton icon="pi pi-arrow-left"
          class="p-button-rounded p-button-text text-white hover:bg-white-alpha-20" (click)="goBack()"
          pTooltip="رجوع للقائمة" tooltipPosition="bottom"></button>
        <div>
          <div class="flex align-items-center gap-2 mb-2 text-primary-100 font-medium text-sm">
            <i class="pi pi-verified"></i>
            <span>تفاصيل التنبيه</span>
          </div>
          <h1 class="text-3xl font-bold m-0 flex align-items-center flex-wrap gap-2">
            تنبيه رقم #{{ alert?.id || "غير محدد" }}
            <p-tag *ngIf="alert" [value]="alert.alertType" severity="info"
              styleClass="text-base font-normal bg-white-alpha-20 text-white"></p-tag>
          </h1>
        </div>
      </div>

      <div class="flex gap-2" *ngIf="alert">
        <button *ngIf="alert.status === 1 || alert.status === 0" pButton label="تحديد كمقروء" icon="pi pi-check"
          class="p-button-success border-round-xl shadow-1" (click)="markAsRead()"></button>
        <button pButton label="تعديل" icon="pi pi-pencil" class="p-button-warning border-round-xl shadow-1"
          (click)="editAlert()"></button>
        <button pButton label="حذف" icon="pi pi-trash"
          class="p-button-danger p-button-outlined bg-white-alpha-10 text-white border-white-alpha-30"
          (click)="deleteAlert($event)"></button>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading"
      class="flex flex-column align-items-center justify-content-center p-6 bg-surface-card border-round-xl shadow-1"
      style="min-height: 400px;">
      <p-progressSpinner styleClass="w-4rem h-4rem" strokeWidth="4"></p-progressSpinner>
      <span class="mt-3 text-600 font-medium">جاري تحميل تفاصيل التنبيه...</span>
    </div>

    <!-- Details Grid -->
    <div *ngIf="!loading && alert" class="grid">
      <!-- Main Info - Left Column -->
      <div class="col-12 lg:col-8">
        <!-- Message Card -->
        <div class="card bg-surface-card shadow-2 border-round-xl p-4 mb-4">
          <div class="flex align-items-center gap-3 mb-4">
            <div class="border-left-3 border-primary h-2rem"></div>
            <h2 class="text-2xl font-bold m-0 text-900">رسالة التنبيه</h2>
          </div>

          <div class="surface-ground border-round-xl p-4 border-1 surface-border flex gap-4">
            <div
              class="w-4rem h-4rem border-circle flex align-items-center justify-content-center bg-primary-100 text-primary-600 text-3xl">
              <i [class]="getAlertTypeIcon(alert.alertType)"></i>
            </div>
            <div class="flex-1">
              <p class="text-xl line-height-3 m-0 text-800 font-medium">{{ alert.message }}</p>
              <div class="mt-3 flex gap-3 align-items-center">
                <p-tag [severity]="getStatusSeverity(alert.status)" [value]="getStatusLabel(alert.status)"></p-tag>
                <span class="text-500 text-sm">تم الإنشاء: {{ alert.createdAt | date:'short' }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Medicine Info -->
        <div class="card bg-surface-card shadow-2 border-round-xl p-4">
          <h2 class="text-xl font-bold m-0 text-900 mb-4">معلومات الدواء</h2>

          <div class="grid">
            <div class="col-12 md:col-4">
              <div class="p-3 surface-ground border-round-xl flex flex-column gap-2 h-full">
                <span class="text-500 text-sm"><i class="pi pi-box mr-1"></i>الدواء</span>
                <strong class="text-900 text-lg">{{ alert.medicineName || 'غير محدد' }}</strong>
              </div>
            </div>
            <div class="col-12 md:col-4">
              <div class="p-3 surface-ground border-round-xl flex flex-column gap-2 h-full">
                <span class="text-500 text-sm"><i class="pi pi-hashtag mr-1"></i>رقم الدفعة</span>
                <strong class="text-900 text-lg font-mono">{{ alert.batchNumber || '-' }}</strong>
              </div>
            </div>
            <div class="col-12 md:col-4">
              <div class="p-3 surface-ground border-round-xl flex flex-column gap-2 h-full">
                <span class="text-500 text-sm"><i class="pi pi-calendar mr-1"></i>تاريخ الانتهاء</span>
                <strong class="text-900 text-lg" [class.text-red-500]="isExpired()">{{ (alert.expiryDate |
                  date:'mediumDate') || '-' }}</strong>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Right Column - Sidebar -->
      <div class="col-12 lg:col-4">
        <!-- Status Card -->
        <div class="card bg-surface-card shadow-2 border-round-xl p-4 mb-4">
          <h3 class="text-lg font-bold m-0 text-900 mb-3">الحالة والوقت</h3>

          <div class="flex flex-column gap-3">
            <div class="flex justify-content-between align-items-center p-3 surface-ground border-round-lg">
              <div class="font-medium text-700">تاريخ التنفيذ</div>
              <div class="font-bold text-primary">{{ alert.executionDate | date:'dd/MM/yyyy' }}</div>
            </div>

            <div class="p-3 border-1 border-primary-100 bg-primary-50 border-round-lg">
              <div class="text-sm text-primary-700 mb-2 font-medium">حالة التنبيه</div>
              <div class="flex align-items-center justify-content-between">
                <span class="text-xl font-bold" [ngClass]="'text-' + getStatusSeverity(alert.status)">{{
                  getStatusLabel(alert.status) }}</span>
                <i
                  class="pi {{ alert.status === 1 || alert.status === 2 ? 'pi-check-circle text-green-500' : 'pi-info-circle text-orange-500' }} text-xl"></i>
              </div>
            </div>
          </div>
        </div>

        <!-- Expiry Countdown -->
        <div class="card bg-surface-card shadow-2 border-round-xl p-4 mb-4" *ngIf="alert.expiryDate">
          <h3 class="text-lg font-bold m-0 text-900 mb-3">العد التنازلي للصلاحية</h3>

          <div class="text-center p-4 border-round-xl" [ngClass]="{
                    'bg-red-50 border-1 border-red-200': isExpired(),
                    'bg-yellow-50 border-1 border-yellow-200': !isExpired() && getDaysUntilExpiry() <= 30,
                    'bg-green-50 border-1 border-green-200': !isExpired() && getDaysUntilExpiry() > 30
                }">
            <div class="text-3xl font-bold mb-1" [ngClass]="{
                        'text-red-600': isExpired(),
                        'text-yellow-600': !isExpired() && getDaysUntilExpiry() <= 30,
                        'text-green-600': !isExpired() && getDaysUntilExpiry() > 30
                    }">
              {{ isExpired() ? 'منتهي' : getDaysUntilExpiry() }}
            </div>
            <div class="text-600 font-medium">{{ isExpired() ? 'منذ أيام' : 'أيام متبقية' }}</div>
          </div>
        </div>

        <!-- Quick Actions (Mobile/Sidebar) -->
        <div class="card bg-surface-card shadow-2 border-round-xl p-4">
          <h3 class="text-lg font-bold m-0 text-900 mb-3">إجراءات سريعة</h3>
          <div class="flex flex-column gap-2">
            <button *ngIf="alert.status === 1 || alert.status === 0" pButton label="تحديد كمقروء" icon="pi pi-check"
              class="p-button-outlined p-button-success w-full" (click)="markAsRead()"></button>
            <button pButton label="تعديل التنبيه" icon="pi pi-pencil" class="p-button-outlined p-button-warning w-full"
              (click)="editAlert()"></button>
            <button pButton label="حذف التنبيه" icon="pi pi-trash" class="p-button-outlined p-button-danger w-full"
              (click)="deleteAlert($event)"></button>
          </div>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="!loading && !alert"
      class="flex flex-column align-items-center justify-content-center p-6 bg-surface-card border-round-xl shadow-1 min-h-[400px]">
      <i class="pi pi-exclamation-circle text-6xl text-300 mb-3"></i>
      <h3 class="text-xl font-bold text-600 mb-2">لم يتم العثور على التنبيه</h3>
      <p class="text-500 mb-4">تعذر تحميل بيانات التنبيه المطلوب أو أنه قد تم حذفه</p>
      <button pButton label="العودة للقائمة" icon="pi pi-arrow-left" class="p-button-outlined"
        (click)="goBack()"></button>
    </div>

  </div>
</div>