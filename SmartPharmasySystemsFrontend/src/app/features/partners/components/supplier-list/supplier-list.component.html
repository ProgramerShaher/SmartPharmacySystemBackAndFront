<!-- supplier-list.component.html -->
<div class="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 p-4 md:p-6">
  <div class="max-w-7xl mx-auto">
    <!-- Header Section -->
    <div class="mb-8">
      <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
        <div>
          <h1 class="text-3xl font-bold text-gray-800 mb-2">إدارة الموردين</h1>
          <p class="text-gray-600">سجل شامل للشركات الموردة والمستحقات المالية</p>
        </div>

        <div class="flex gap-3">
          <button aria-label="edit" pButton pRipple
                  label="مورد جديد"
                  icon="pi pi-plus-circle"
                  class="p-button-primary bg-gradient-to-r from-blue-600 to-indigo-600 border-none"
                  (click)="addNewSupplier()"
                  pTooltip="إضافة مورد جديد"
                  tooltipPosition="bottom"></button>
          <button aria-label="edit" pButton pRipple
                  icon="pi pi-sync"
                  class="p-button-outlined"
                  (click)="loadSuppliers()"
                  [loading]="loading"
                  pTooltip="تحديث البيانات"
                  tooltipPosition="bottom"></button>
        </div>
      </div>

      <!-- Search Bar -->
      <div class="mb-6">
        <div class="relative max-w-md">
          <i class="pi pi-search absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
          <input type="text"
                 pInputText
                 placeholder="ابحث عن مورد بالاسم، الهاتف، أو العنوان..."
                 class="w-full pl-10 pr-4 py-3 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all"
                 [(ngModel)]="searchTerm"
                 (input)="onSearch()">
          <small class="text-gray-500 text-xs mt-1 block">
            اكتب للبحث عن مورد معين
          </small>
        </div>
      </div>
    </div>

    <!-- Statistics Cards -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
      <div class="bg-white rounded-xl shadow p-4">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-500 text-sm">إجمالي الموردين</p>
            <p class="text-2xl font-bold text-gray-800">{{ suppliers.length }}</p>
          </div>
          <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
            <i class="pi pi-users text-blue-600 text-xl"></i>
          </div>
        </div>
      </div>

      <div class="bg-white rounded-xl shadow p-4">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-500 text-sm">مدينون</p>
            <p class="text-2xl font-bold text-orange-600">
              {{ getSuppliersWithBalance() }}
            </p>
          </div>
          <div class="w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center">
            <i class="pi pi-exclamation-triangle text-orange-600 text-xl"></i>
          </div>
        </div>
      </div>

      <div class="bg-white rounded-xl shadow p-4">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-500 text-sm">بلا مديونية</p>
            <p class="text-2xl font-bold text-green-600">
              {{ getSuppliersWithBalance() }}
            </p>
          </div>
          <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center">
            <i class="pi pi-check-circle text-green-600 text-xl"></i>
          </div>
        </div>
      </div>

      <div class="bg-white rounded-xl shadow p-4">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-500 text-sm">إجمالي الدين</p>
            <p class="text-2xl font-bold text-red-600">
              {{ getTotalBalance() | currency:'YER ':'symbol':'1.0-0' }}
            </p>
          </div>
          <div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center">
            <i class="pi pi-money-bill text-red-600 text-xl"></i>
          </div>
        </div>
      </div>
    </div>

    <!-- Data Table -->
    <div class="bg-white rounded-xl shadow overflow-hidden">
      <!-- Loading State -->
      <div *ngIf="loading" class="p-8 text-center">
        <div class="w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
        <p class="text-gray-600 font-medium">جاري تحميل بيانات الموردين...</p>
      </div>

      <!-- Table -->
      <div *ngIf="!loading">
        <p-table [value]="suppliers"
                 [paginator]="true"
                 [rows]="10"
                 [rowsPerPageOptions]="[5, 10, 20, 50]"
                 [showCurrentPageReport]="true"
                 currentPageReportTemplate="عرض {first} إلى {last} من {totalRecords} مورد"
                 styleClass="p-datatable-striped p-datatable-gridlines">

          <ng-template pTemplate="header">
            <tr>
              <th pSortableColumn="name" class="text-right py-4 px-6">
                <div class="flex items-center gap-2">
                  <span>المورد</span>
                  <p-sortIcon field="name"></p-sortIcon>
                </div>
              </th>
              <th class="text-right py-4 px-6">جهة الاتصال</th>
              <th class="text-right py-4 px-6">رقم الهاتف</th>
              <th pSortableColumn="balance" class="text-right py-4 px-6">
                <div class="flex items-center gap-2">
                  <span>الرصيد</span>
                  <p-sortIcon field="balance"></p-sortIcon>
                </div>
              </th>
              <th class="text-center py-4 px-6">العمليات</th>
            </tr>
          </ng-template>

          <ng-template pTemplate="body" let-supplier>
            <tr class="hover:bg-gray-50 transition-colors">
              <td class="py-4 px-6">
                <div class="flex items-center gap-3">
                  <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full flex items-center justify-center text-white font-bold">
                    {{ supplier.name.charAt(0) }}
                  </div>
                  <div>
                    <div class="font-bold text-gray-800">{{ supplier.name }}</div>
                    <div class="text-sm text-gray-500">{{ supplier.email || 'بدون بريد' }}</div>
                  </div>
                </div>
              </td>

              <td class="py-4 px-6">
                <div class="font-medium text-gray-700">{{ supplier.contactPerson || 'غير محدد' }}</div>
              </td>

              <td class="py-4 px-6">
                <div class="flex items-center gap-2">
                  <i class="pi pi-phone text-green-600"></i>
                  <span class="font-mono font-medium">{{ supplier.phoneNumber }}</span>
                </div>
              </td>

              <td class="py-4 px-6">
                <div [ngClass]="{
                  'text-green-600': (supplier.balance || 0) <= 0,
                  'text-orange-600': (supplier.balance || 0) > 0 && (supplier.balance || 0) <= 100000,
                  'text-red-600': (supplier.balance || 0) > 100000
                }">
                  <span class="font-bold text-lg">
                    {{ (supplier.balance || 0) | currency:'YER ':'symbol':'1.0-0' }}
                  </span>
                </div>
              </td>

              <td class="py-4 px-6">
                <div class="flex justify-center gap-1">
                  <button aria-label="edit" pButton pRipple
                          icon="pi pi-eye"
                          class="p-button-rounded p-button-text p-button-info"
                          (click)="viewDetails(supplier.id)"
                          pTooltip="عرض التفاصيل"
                          tooltipPosition="top"></button>

                  <button aria-label="edit" pButton pRipple
                          icon="pi pi-pencil"
                          class="p-button-rounded p-button-text p-button-warning"
                          (click)="editSupplier(supplier.id)"
                          pTooltip="تعديل"
                          tooltipPosition="top"></button>

                  <button aria-label="edit" pButton pRipple
                          icon="pi pi-trash"
                          class="p-button-rounded p-button-text p-button-danger"
                          (click)="deleteSupplier($event, supplier)"
                          pTooltip="حذف"
                          tooltipPosition="top"></button>
                </div>
              </td>
            </tr>
          </ng-template>

          <ng-template pTemplate="emptymessage">
            <tr>
              <td colspan="5" class="py-12">
                <div class="text-center">
                  <i class="pi pi-users text-6xl text-gray-300 mb-4"></i>
                  <h3 class="text-xl font-bold text-gray-500 mb-2">لا توجد موردين</h3>
                  <p class="text-gray-400 mb-4">ابدأ بإضافة أول مورد إلى نظامك</p>
                  <button aria-label="edit" pButton
                          label="إضافة مورد جديد"
                          icon="pi pi-plus"
                          class="p-button-primary"
                          (click)="addNewSupplier()"></button>
                </div>
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </div>

    <!-- Quick Actions Footer -->
    <div class="mt-6 flex justify-between items-center text-sm text-gray-500">
      <div>
        <i class="pi pi-info-circle mr-2"></i>
        <span>إجمالي {{ suppliers.length }} مورد</span>
      </div>
      <div>
        <span>آخر تحديث: {{ today | date:'short' }}</span>
      </div>
    </div>
  </div>
</div>

<p-confirmDialog
  [rtl]="true"
  styleClass="max-w-md rounded-xl"
  rejectButtonStyleClass="p-button-text p-button-sm"
  acceptButtonStyleClass="p-button-danger p-button-sm"></p-confirmDialog>

<p-toast position="bottom-left"></p-toast>
