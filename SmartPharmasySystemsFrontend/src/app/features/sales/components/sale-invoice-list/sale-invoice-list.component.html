<div class="card p-4 shadow-2 border-round-xl" dir="rtl">
    <div class="flex align-items-center justify-content-between mb-5">
        <div class="flex align-items-center gap-3">
            <div
                class="w-3rem h-3rem border-circle bg-primary-reverse flex align-items-center justify-content-center shadow-1">
                <i class="pi pi-file-export text-primary text-xl"></i>
            </div>
            <div>
                <h2 class="text-2xl font-bold m-0 text-primary">فواتير المبيعات</h2>
                <small class="text-secondary font-medium">عرض وإدارة فواتير بيع الأدوية للعملاء</small>
            </div>
        </div>
        <p-button label="فاتورة بيع جديدة" icon="pi pi-plus" severity="success" class="shadow-1"
            (onClick)="createSale()"></p-button>
    </div>

    <p-table #dt [value]="sales" [rows]="10" [paginator]="true" [globalFilterFields]="['invoiceNumber', 'customerName']"
        [rowHover]="true" dataKey="id" [loading]="loading"
        currentPageReportTemplate="عرض {first} إلى {last} من أصل {totalRecords}" [showCurrentPageReport]="true"
        styleClass="p-datatable-gridlines p-datatable-sm shadow-1 border-round-xl overflow-hidden">

        <ng-template pTemplate="caption">
            <div class="flex align-items-center justify-content-end gap-2">
                <span class="p-input-icon-left w-full md:w-20rem">
                    <i class="pi pi-search"></i>
                    <input pInputText type="text" (input)="dt.filterGlobal($any($event.target).value, 'contains')"
                        placeholder="ابحث برقم الفاتورة أو اسم العميل..." class="w-full border-round-xl" />
                </span>
            </div>
        </ng-template>

        <ng-template pTemplate="header">
            <tr>
                <th pSortableColumn="invoiceNumber" class="bg-gray-50 p-3">رقم الفاتورة <p-sortIcon
                        field="invoiceNumber"></p-sortIcon></th>
                <th pSortableColumn="saleInvoiceDate" class="bg-gray-50 p-3">التاريخ <p-sortIcon
                        field="saleInvoiceDate"></p-sortIcon></th>
                <th pSortableColumn="customerName" class="bg-gray-50 p-3">العميل <p-sortIcon
                        field="customerName"></p-sortIcon></th>
                <th pSortableColumn="totalAmount" class="bg-gray-50 p-3 text-center">الإجمالي <p-sortIcon
                        field="totalAmount"></p-sortIcon></th>
                <th pSortableColumn="status" class="bg-gray-50 p-3 text-center">الحالة <p-sortIcon
                        field="status"></p-sortIcon></th>
                <th class="bg-gray-50 p-3 text-center">الإجراءات</th>
            </tr>
        </ng-template>

        <ng-template pTemplate="body" let-sale>
            <tr class="hover:bg-gray-50 transition-colors">
                <td class="font-bold text-primary">{{sale.invoiceNumber || '#' + sale.id}}</td>
                <td>{{sale.saleInvoiceDate | date:'dd/MM/yyyy HH:mm'}}</td>
                <td>
                    <div class="flex align-items-center gap-2">
                        <i class="pi pi-user text-secondary"></i>
                        <span>{{sale.customerName || 'عميل نقدي'}}</span>
                    </div>
                </td>
                <td class="text-center font-bold">{{sale.totalAmount | number:'1.2-2'}} ريال يمني</td>
                <td class="text-center">
                    <p-tag [severity]="getStatusSeverity(sale.status)" [value]="getStatusLabel(sale.status)"
                        [rounded]="true"></p-tag>
                </td>
                <td class="text-center">
                    <div class="flex justify-content-center gap-1">
                        <button pButton icon="pi pi-eye" class="p-button-rounded p-button-text p-button-info"
                            pTooltip="عرض التفاصيل" (click)="viewSale(sale)"></button>

                        <button *ngIf="sale.status === 'Draft'" pButton icon="pi pi-check-circle"
                            class="p-button-rounded p-button-text p-button-success" pTooltip="اعتماد الفاتورة"
                            (click)="approveSale(sale)"></button>

                        <button *ngIf="sale.status === 'Approved'" pButton icon="pi pi-times-circle"
                            class="p-button-rounded p-button-text p-button-danger" pTooltip="إلغاء الفاتورة"
                            (click)="cancelSale(sale)"></button>
                    </div>
                </td>
            </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
            <tr>
                <td colspan="6" class="text-center p-5">لا توجد فواتير مبيعات حالياً.</td>
            </tr>
        </ng-template>
    </p-table>
</div>

<p-confirmDialog [style]="{width: '450px'}"></p-confirmDialog>