<div class="supplier-container animate-fade-in" dir="rtl">
  <!-- Decorative background element -->
  <div class="absolute top-0 right-0 w-30rem h-30rem bg-blue-500 opacity-5 border-circle blur-3xl pointer-events-none">
  </div>

  <!-- Header with Stats -->
  <div class="premium-header mb-6">
    <div
      class="flex flex-column lg:flex-row justify-content-between align-items-start lg:align-items-center mb-6 gap-4">
      <div class="header-title">
        <div class="flex align-items-center gap-4 mb-2">
          <div class="icon-wrapper">
            <i class="pi pi-truck text-3xl"></i>
          </div>
          <div>
                        <h1 class="text-5xl font-bold m-0 tracking-tight">إدارة الموردين</h1>
                        <p class="text-color-secondary mt-1 text-xl opacity-80">نظام ذكي لمراقبة الشركاء، الأرصدة، وسلسلة التوريد</p>
                        </div>
                </div>
                </div>
                <div class="flex gap-3 w-full lg:w-auto">
                  <p-button label="سندات الصرف" icon="pi pi-wallet" routerLink="/partners/suppliers/payments"
                    styleClass="p-button-outlined p-button-rounded h-3rem font-bold border-2 hover:bg-blue-50 transition-colors">
                  </p-button>
                  <p-button label="إضافة مورد جديد" icon="pi pi-plus-circle"
                    routerLink="/partners/suppliers/create"
                    styleClass="p-button-raised p-button-rounded premium-btn shadow-6">
                </p-button>
            </div>
        </div>

        <div class="grid mt-4">
          <!-- Total Debt Card -->
          <div class="col-12 md:col-6 lg:col-4">
            <div class="stat-card glass-morphism debt">
              <div class="flex justify-content-between align-items-start">
                <div>
                  <span class="block text-600 font-bold mb-3 uppercase tracking-widest text-sm">إجمالي المديونية المستحقة</span>
                  <div class="text-red-500 font-bold text-4xl mb-2">{{ totalDebt() | number }} <small
                      class="text-lg">ر.ي</small></div>
                </div>
                        <div class="stat-icon red-light-bg shadow-2">
                          <i class="pi pi-chart-line text-2xl"></i>
                        </div>
                        </div>
                    <div class="mt-4">
                      <div class="flex justify-content-between mb-2">
                        <span class="text-sm font-semibold opacity-70">معدل التحصيل / السداد</span>
                        <span class="text-sm font-bold text-red-600">60%</span>
                      </div>
                        <p-progressBar [value]="60" [showValue]="false" styleClass="h-6px"></p-progressBar>
                        </div>
                        </div>
                        </div>

            <!-- High Debt Suppliers Card -->
            <div class="col-12 md:col-6 lg:col-4">
              <div class="stat-card glass-morphism high-debt">
                <div class="flex justify-content-between align-items-start">
                  <div>
                            <span class="block text-600 font-bold mb-3 uppercase tracking-widest text-sm">موردين بمديونية حرجة</span>
                            <div class="text-orange-500 font-bold text-4xl mb-1">{{ highDebtCount() }}</div>
                            </div>
                        <div class="stat-icon orange-light-bg shadow-2">
                          <i class="pi pi-exclamation-circle text-2xl"></i>
                        </div>
                        </div>
                        <div class="mt-4 text-sm font-medium">
                          <span class="text-orange-600"><i class="pi pi-info-circle ml-1"></i> تنبيه:</span> يحتاج بعض الموردين لتسوية أرصدتهم
                          فوراً
                        </div>
                        </div>
                        </div>

            <!-- Total Suppliers Card -->
            <div class="col-12 lg:col-4">
              <div class="stat-card glass-morphism total-suppliers">
                <div class="flex justify-content-between align-items-start">
                  <div>
                            <span class="block text-600 font-bold mb-3 uppercase tracking-widest text-sm">إجمالي شبكة الموردين</span>
                            <div class="text-blue-600 font-bold text-4xl mb-1">{{ suppliers().length }}</div>
                            </div>
                        <div class="stat-icon blue-light-bg shadow-2">
                          <i class="pi pi-users text-2xl"></i>
                        </div>
                        </div>
                    <div class="mt-4 text-sm">
                      <span class="text-green-500 font-bold bg-green-50 px-2 py-1 border-round-lg ml-2"><i
                          class="pi pi-arrow-up text-xs mr-1"></i> 8%</span>
                      <span class="text-600 font-medium">نمو في عدد الموردين هذا الشهر</span>
                    </div>
                </div>
                </div>
                </div>
    </div>

    <!-- Table Section -->
    <div class="glass-panel p-0 overflow-hidden shadow-8 border-round-3xl bg-white-alpha-80 border-1 border-white-alpha-30">
      <p-table [value]="suppliers()" [loading]="loading()" [paginator]="true" [rows]="10"
            [rowsPerPageOptions]="[10, 25, 50]"
            [showCurrentPageReport]="true"
            currentPageReportTemplate="عرض {first} إلى {last} من أصل {totalRecords}"
            styleClass="premium-table">
            
            <ng-template pTemplate="caption">
                <div class="flex flex-column md:flex-row justify-content-between align-items-center p-4 gap-3">
                    <div class="flex align-items-center gap-2">
                        <i class="pi pi-list text-2xl text-blue-600"></i>
                        <span class="text-xl font-bold text-900">قائمة الشركاء التجاريين</span>
                    </div>
                    <div class="flex gap-2 w-full md:w-auto">
                        <span class="p-input-icon-left w-full">
                            <i class="pi pi-search text-600"></i>
                            <input pInputText type="text" placeholder="ابحث بالاسم، الهاتف، أو العنوان..." class="w-full md:w-25rem" />
                        </span>
                        <p-button icon="pi pi-filter" styleClass="p-button-text p-button-secondary border-1 border-200"></p-button>
                    </div>
                </div>
            </ng-template>

            <ng-template pTemplate="header">
              <tr>
                    <th class="text-right">معلومات المورد</th>
                    <th class="text-right">بيانات التواصل</th>
                    <th class="text-right" pSortableColumn="balance">الرصيد المالي <p-sortIcon field="balance"></p-sortIcon></th>
                    <th class="text-right">تاريخ الإضافة</th>
                    <th class="text-right">الحالة</th>
                    <th class="text-center">إجراءات التحكم</th>
                    </tr>
                    </ng-template>

            <ng-template pTemplate="body" let-supplier>
                <tr class="hover-row">
                  <td>
                    <div class="flex align-items-center gap-3">
                      <div class="avatar-circle shadow-4" [style.background]="getRandomColor(supplier.name)">
                        {{ supplier.name?.charAt(0) }}
                      </div>
                            <div class="flex flex-column gap-1">
                              <span class="font-bold text-900 text-lg">{{ supplier.name }}</span>
                              <div class="flex align-items-center text-600 text-xs">
                                <i class="pi pi-map-marker ml-1"></i>
                                <span>{{ supplier.address || 'لم يتم تحديد عنوان' }}</span>
                              </div>
                            </div>
                            </div>
                            </td>
                    <td>
                      <div class="flex flex-column gap-2">
                        <a [href]="'tel:' + supplier.phoneNumber"
                          class="no-underline text-blue-600 font-bold flex align-items-center gap-2 hover:underline">
                          <div class="w-2rem h-2rem border-circle bg-blue-50 flex align-items-center justify-content-center">
                            <i class="pi pi-phone text-xs"></i>
                          </div>
                          <span>{{ supplier.phoneNumber }}</span>
                        </a>
                        <div class="flex align-items-center gap-2 text-600 text-sm italic">
                          <i class="pi pi-envelope text-xs"></i>
                          <span>{{ supplier.email || 'لا يوجد بريد' }}</span>
                        </div>
                      </div>
                    </td>
                    <td class="font-bold">
                      <div class="flex flex-column">
                        <span [class]="supplier.balance > 0 ? 'text-red-500' : 'text-green-500'" class="text-xl">
                          {{ supplier.balance | number }} <small class="text-xs">ر.ي</small>
                        </span>
                            <span class="text-xs text-500 font-medium">{{ supplier.balance > 0 ? 'ذمم مستحقة' : 'رصيد دائن' }}</span>
                            </div>
                            </td>
                            <td class="text-600">
                              <div class="flex align-items-center gap-2">
                                <i class="pi pi-calendar-plus opacity-70"></i>
                                <span>{{ supplier.createdAt | date:'yyyy/MM/dd' }}</span>
                        </div>
                        </td>
                    <td>
                      <p-tag [severity]="supplier.isActive ? 'success' : 'danger'" [value]="supplier.isActive ? 'نشط' : 'متوقف'"
                        [rounded]="true" styleClass="px-4 py-2 text-xs font-bold shadow-1">
                      </p-tag>
                    </td>
                    <td class="text-center">
                      <div class="flex justify-content-center gap-2">
                        <button pButton icon="pi pi-id-card" class="p-button-rounded p-button-text hover:bg-blue-50"
                          pTooltip="عرض الملف الشخصي" [routerLink]="['/partners/suppliers/detail', supplier.id]"></button>
                        <button pButton icon="pi pi-file-pdf" class="p-button-rounded p-button-text p-button-success hover:bg-green-50"
                          pTooltip="كشف الحساب التفصيلي" [routerLink]="['/partners/suppliers/statement', supplier.id]"></button>
                        <button pButton icon="pi pi-wallet" class="p-button-rounded p-button-text p-button-info hover:bg-cyan-50"
                          pTooltip="إنشاء سند صرف" [routerLink]="['/partners/suppliers/payments']"
                          [queryParams]="{supplierId: supplier.id}"></button>
                        <button pButton icon="pi pi-pencil" class="p-button-rounded p-button-text p-button-warning hover:bg-orange-50"
                          pTooltip="تعديل البيانات" [routerLink]="['/partners/suppliers/edit', supplier.id]"></button>
                        <button pButton icon="pi pi-trash" class="p-button-rounded p-button-text p-button-danger hover:bg-red-50"
                          pTooltip="حذف نهائي" (click)="deleteSupplier($event, supplier)"></button>
                      </div>
                    </td>
                    </tr>
                    </ng-template>

            <ng-template pTemplate="emptymessage">
              <tr>
                    <td colspan="6" class="text-center p-8 bg-white-alpha-50">
                      <div class="empty-state">
                        <div
                          class="w-8rem h-8rem bg-blue-50 border-circle flex align-items-center justify-content-center mx-auto mb-4 shadow-2">
                          <i class="pi pi-truck text-6xl text-blue-300"></i>
                        </div>
                        <h3 class="text-2xl font-bold text-700 mb-2">لا يوجد موردون حالياً</h3>
                        <p class="text-500 mb-6 text-lg">لم يتم العثور على أي بيانات، ابدأ ببناء شبكة الموردين الخاصة بك الآن</p>
                        <p-button label="إضافة أول مورد" icon="pi pi-plus" routerLink="/partners/suppliers/create"
                          styleClass="p-button-rounded premium-btn px-6"></p-button>
                      </div>
                    </td>
                    </tr>
                    </ng-template>
        </p-table>
    </div>
</div>

<p-confirmDialog [style]="{width: '500px'}" styleClass="premium-dialog" [rtl]="true"></p-confirmDialog>
<p-toast position="top-left"></p-toast>
